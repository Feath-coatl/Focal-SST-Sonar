# Focal SST 说明文档(施工中)

## 🚀核心特性
1. 抗噪特征提取 (SDAVFE): 针对声纳散斑噪声，简化 TANet 设计了 Stacked Double Attention VFE，在体素化阶段进行细粒度的特征清洗。

2. 结构补全(Focal Sparse Encoder): 引入 Focal 机制预测体素重要性，通过动态致密化（Dilation）填补声纳盲区导致的目标结构缺失。

3. 高效长程建模(DSVT Backbone): 采用动态稀疏体素Transformer，利用旋转集合划分策略，无需填充即可处理极度稀疏的声纳数据，大幅提升推理效率。

4. 完整的数据工具链: 内置专用的声纳数据增强流水线（仿射、混合、截断、抖动）及多视图可视化工具。


## 项目架构
> '''
Focal-SST-Sonar/
├── MainFocal/
│   ├── data_augment/           # [工具箱] 3D声纳数据增强工具
│   │   ├── build_object_db.py  # 构建前景目标数据库
│   │   ├── run_augmentation.py # 运行批量增强
│   │   └── ...
│   ├── data_visual_analyze/    # [工具箱] 可视化与统计分析工具
│   │   ├── pointcloud_visualizer.py      # 单视图查看
│   │   ├── dual_pointcloud_visualizer.py # 增强效果对比
│   │   └── ...
│   ├── focalSST-master/        # 模型训练与推理框架(基于OpenPCDet/DSVT)
│   │   ├── pcdet/models/       # 模型定义(Backbones, DenseHeads等)
│   │   ├── tools/              # 训练脚本(train.py, test.py)
│   │   └── ...
│   └── data_label/             # 数据标注与修正脚本
├── requirements.txt            # 项目依赖
└── README.md                   # 项目说明
'''

## 文件架构

### Data_augment
用于原始数据集的数据增强
- *build_object_db.py*：指定数据集文件夹，提取所有的目标，生成为.pkl文件。
- *augment_utils.py*：提供用于数据增强的相关组件函数
- *run_augmentation.py*: 数据增强主流程，利用上面生成的.pkl文件和组件函数。

详情见该文件夹内 *README.md*

### Data_label
用于数据的标注测试与错误修复（该测试已结束，不再用于项目主流程）
- *bb_err_detect*：用于检测原始数据集中的标注错误，终端输出存在标注错误的文件。
- *bb_err_fix.py*：将点云目标类标注出来的离群噪点筛出，重新标注为正确的噪声类。
- *data_bb_calc.py*：计算目标点云的包围盒，测试标注效果。
  - 该包围盒参数为7D，分别是cx,cy,cz,lx,ly,lz,rot。

### Data_visual_analyze
用于数据的可视化与数据集相关分析
- *analyze_intensity.py*：分析数据集的强度信息，输出为.json文件。
- *calculate_dataset_range.py*：分析数据集的尺寸范围。
  - 运行结果已经在该程序首部给出，无需再次运行。
- *pointcloud_statistics.py*： 输出.json文件，给出数据集中每类目标所处数据文件位置，统计信息包括该目标在该帧点数以及中心位置。
- *<dual_>pointcloud_visualizer.py*：点云可视化程序，含dual_字样的为对比程序，可以对比同名的原始文件与增强后文件的效果。

## 数据集架构
训练集：8554
验证集：3666
总数：12220（包含3194帧原始数据与9026帧增强数据）

数据为3D声呐采集后转换数据，单帧格式为点云的.TXT文件，每一行包含 5 列数据以**空格分隔**：
1. `x` (坐标)
2. `y` (坐标)
3. `z` (坐标)
4. `intensity` (声呐强度，数值范围很大，统计分析报告在项目的intensity_analysis_report.json)
5. `class_id` (类别标签，用于监督训练。其中，class_id = 1.0代表木框Box，2.0代表蛙人Diver，3.0代表其他背景数据或者噪声，4.0代表水面。只有木框和蛙人被视作需要识别的目标。)

原始数据的XYZ坐标系说明：
- X轴指的是目标中心在声呐前/后方向的距离，正为前（远离声呐）；
- Y轴指的是目标中心在声呐左/右方向的距离，正为左、负为右；
- Z轴指的是目标中心在声呐上下的高度，正为上。

> 数据集 XYZ 全局范围统计结果
> 轴     | 最小值   | 最大值     | 跨度 
> X     | 0.0264          | 48.6371         | 48.6107
> Y     | -19.9508        | 19.5764         | 39.5272
> Z     | -19.3662        | 13.8041         | 33.1703
> 统计文件总数: 12220

在该数据集中，保证每一类目标在每一帧只出现一个，因此对同类目标不再需要聚类，只需要将该类目标数据视为一个整体。

该数据集中还有一些特点：
- 点的间距与该点和声呐的距离正相关。在近处，大小为[0.5, 0.5, 0.5]的体素可能包含几百个点，但在最远处则可能只有几个点。
- 由于声呐特殊成像机制，它的X轴分辨率要明显高于Y和Z，且不会随着距离增加而导致点间距变大。
- 声呐数据包含完整的3D信息，而不是激光雷达的2.5D数据，在声呐数据中可能出现两个目标处于同一（X,Y）坐标但不同高度的情况。

## 其余说明